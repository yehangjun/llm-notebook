# Prism SPEC V2

## 账号系统设计

### 功能设计
- 注册（密码制）
  - ID 和 email 均唯一校验，用户输入
  - 密码 与 密码校验
  - 昵称、界面语言（中/英，缺省中）
  - 支持 email 验证码
- 登录（密码制）：支持 ID 或 email 登录
- 个人资料页：ID 和 email 之外都可修改
- 支持退出登录
- 支持登录失败限制（轻量风控）
- 支持忘记密码 / 重置密码
- 后端仍保留可插拔 SSO 路由与 provider（gmail/wechat），但前端不展示入口
- 发信账号为：llm_notebook@163.com

## 管理系统设计

### 总体设计
系统初始化时候加一个管理员账号，和用户账号系统共享，该账号不能被改成非管理员

### 账号管理设计
- 管理所有用户账号，修改所有可修改的状态，以及删除用户
- 避免关联的笔记等数据变成孤儿，用户删除之后数据库记录继续保留
  - 但用户不可登录、不可见，逻辑上被删除
  - 之前的用户 ID 和 email 被释放出来，可以被别人注册
  - 关联的笔记不可见，逻辑上被删除
- 被删除的用户在管理系统里显示，但不能恢复（ID/email可能已被注册）

### 笔记管理设计
- 管理所有笔记，不可修改用户笔记内容，只可以 删除笔记 和 恢复被删除的笔记
- 支持按照状态、属性等查询过滤，包括逻辑删除状态

## 学习笔记设计

### 功能设计
- 每条笔记绑定一个外部链接，不支持上传文件
  - 所有网站的外部链接都支持
  - 下列网站做归一化和去重：
    - 微信公众号、YouTube
  - 在笔记中显式的URL是归一化之后的
- 先自动通过大模型对外部链接做摘要分析
  - 记录下摘要分析内容、分析时间、所用大模型的版本之类的信息
  - 这部分用户不可修改编辑
- AI 摘要分析状态包括：`待分析`、`分析中`、`成功`、`失败`
- 解析或分析失败时，用户可看到失败提示，并支持手动重试
- 用户书写自己的学习心得
  - 提交后用户可以继续编辑
- 支持公开分享（私有/公开，缺省公开）
  - 私有：仅本人可见和编辑
  - 公开：任何人可查看，只读
- 同一用户重复提交同一外部链接时，提示已存在并跳转到已有笔记
- 用户可以删除笔记
  - 系统里先做逻辑删除，对所有用户都不再可见
  - 暂时不做回收站功能

### 验收要点
- 创建笔记后会自动触发 AI 摘要分析，并可见状态流转
- AI 摘要可展示且不可被用户编辑
- 学习心得可反复编辑并保存
- 私有笔记不可被他人访问，公开笔记可被他人只读访问
- 失败场景有明确提示，并可手动重试

## 聚合信息流设计

### 功能设计
- Prism 维护一套聚合内容条目，每条条目绑定一个外部链接
- 聚合条目和用户笔记的外部链接都触发同类 AI 分析流程
  - 记录分析状态、分析结果、分析时间和模型版本
- 聚合条目支持标签，用于信息流筛选
- 推荐先按内容更新时间倒排，不做复杂推荐算法
- 本期不做全网自动抓取与复杂运营后台，采用可控的聚合录入方式

### 验收要点
- 新增聚合条目后可在聚合流看到，并触发 AI 分析
- 聚合内容分析结果可见，失败时有明确提示
- 标签筛选可生效，排序符合更新时间倒排规则

## 关注信息流设计

### 功能设计
- 来自用户已关注账号的公开笔记
- 支持关注/取消关注其他用户
  - 不可关注自己
- 支持收藏/取消收藏公开笔记
  - 仅公开笔记可被收藏
- 支持标签筛选
  - 标签可用于聚合流筛选
  - 关注流可按标签筛选公开笔记（若笔记有标签）
- 当公开笔记转为私有或被删除时：
  - 不再出现在关注流中
  - 不再对外可见

### 验收要点
- 关注用户后，目标用户新增公开笔记可在关注流出现
- 取消关注后，不再看到该用户后续公开笔记
- 收藏公开笔记后可在收藏入口看到，取消收藏后消失
- 关注流和聚合流可独立按标签筛选

## 页面与交互设计

风格：极简主义，参考NotebookLM、Medium、Notion等
参考：design/*.html

### 总体设计
页面顶部有一个全局导航条，分左中右三个区：
- 左：产品名（回到主页），搜索框（设计参见Medium）
- 中：笔记（学习笔记），广场（信息流）
- 右：写笔记（用个写作图标），通知信息（用个铃铛图标），账号

### 账号
- 首页右上角有一个账号入口按钮：
  - 未登录：`登录/注册`
  - 已登录：显示`昵称`(如有)或者`ID`
- 点击后：
  - 未登录：进入认证页（登录/注册双Tab）
  - 已登录：进入个人资料页
- 登录/退出登录，导航条中这个账号入口按钮自动发生变化
- 普通用户登录成功后进入`信息流`模块
- 管理员登录成功后进入`管理系统`模块

### 笔记
左右分两栏：
- 均为笔记列表
  - 展示来源标题，更新时间，收藏/点赞计数，标签，AI 摘要 和 学习心得 的`摘要` (便于列表显示)
- 左：自己的笔记
  - 列表展示：分析状态，可见性
  - 详情页展示：来源信息，AI 摘要（只读），学习心得（可编辑），私有/公开切换
- 右：收藏的笔记
  - 列表展示：作者名
  - 详情页展示：来源信息，AI 摘要（只读），学习心得（只读）

### 广场
左右分两栏：
- 均为信息流
  - 展示来源标题，更新时间，收藏/点赞计数（外链及相关学习笔记的总计数），AI 摘要 的`摘要`
- 左：关注流
- 右：聚合流
