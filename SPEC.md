# Prism SPEC V2

## 页面总体设计
页面设计请参考 design/*.html
关于总体设计风格：
- 极简主义，参考NotebookLM、Medium、Notion等
- 页面顶部有一个全局导航条

## 账号系统设计

### 功能设计
- 注册（密码制）
  - ID 和 email 均唯一校验，用户输入
  - 密码 与 密码校验
  - 昵称、界面语言（中/英，缺省中）
  - 支持 email 验证码
- 登录（密码制）：支持 ID 或 email 登录
- 个人资料页：ID 和 email 之外都可修改
- 支持退出登录
- 支持登录失败限制（轻量风控）
- 支持忘记密码 / 重置密码
- 后端仍保留可插拔 SSO 路由与 provider（gmail/wechat），但前端不展示入口
- 发信账号为：llm_notebook@163.com

### 交互与页面设计
- 首页右上角有一个账号入口按钮：
  - 未登录：`登录/注册`
  - 已登录：显示`昵称`（若有且不等于ID）否则显示`ID`
- 点击后：
  - 未登录：进入认证页（登录/注册双 Tab）
  - 已登录：进入个人资料页
- 登录/退出登录，导航条中这个账号入口按钮自动发生变化
- 普通用户登录成功后进入`学习笔记`模块
- 管理员登录成功后进入`管理系统`模块

## 管理系统设计

### 总体设计
- 系统初始化时候加一个管理员账号，和用户账号系统共享
  - 该账号不能被改成非管理员
- 管理员登录之后用户前端界面显示管理入口

### 账号管理设计
- 管理所有用户账号，修改所有可修改的状态，以及删除用户
- 避免关联的笔记等数据变成孤儿，用户删除之后数据库记录继续保留
  - 但用户不可登录、不可见，逻辑上被删除
  - 之前的用户 ID 和 email 被释放出来，可以被别人注册
  - 管理的笔记不可见，逻辑上被删除

### 笔记管理设计
- 管理所有笔记，不可修改用户笔记内容，只可以删除笔记 和 恢复被删除的笔记
- 和学习笔记的用户入口类似，支持按照状态、属性等查询过滤，包括逻辑删除状态

## 学习笔记设计

### 功能设计
- 每条笔记绑定一个外部链接，不支持上传文件
  - 所有网站的外部链接都支持
  - 下列网站做归一化和去重：
    - 微信公众号、YouTube
  - 在笔记中显式的URL是归一化之后的
- 先自动通过大模型对外部链接做摘要分析
  - 记录下摘要分析内容、分析时间、所用大模型的版本之类的信息
  - 这部分用户不可修改编辑
- AI 摘要分析状态包括：`待分析`、`分析中`、`成功`、`失败`
- 解析或分析失败时，用户可看到失败提示，并支持手动重试
- 用户书写自己的学习心得
  - 提交后用户可以继续编辑
- 支持公开分享（私有/公开）
  - 私有：仅本人可见和编辑
  - 公开：任何人可查看，只读
- 同一用户重复提交同一外部链接时，提示已存在并跳转到已有笔记
- 用户可以删除笔记
  - 系统里先做逻辑删除，对所有用户都不再可见
  - 暂时不做回收站功能

### 交互与页面设计
- 笔记列表页：展示来源标题、分析状态、可见性、更新时间
- 新建笔记页：输入外部链接并创建
- 笔记详情页：来源信息、AI 摘要（只读）、学习心得（可编辑）、私有/公开切换
- 公开笔记页：展示来源信息、AI 摘要和学习心得（只读）

### 验收要点
- 创建笔记后会自动触发 AI 摘要分析，并可见状态流转
- AI 摘要可展示且不可被用户编辑
- 学习心得可反复编辑并保存
- 私有笔记不可被他人访问，公开笔记可被他人只读访问
- 失败场景有明确提示，并可手动重试


## 自动聚合设计
本期暂不设计，仅支持用户手动提供外部链接
